---
import { Image } from "astro:assets";
import ns2agiLogo from "../assets/ns2agi-logo.svg";
import { Menu, X, ChevronDown } from "lucide-react";

const navLinks = [
    { name: "PROJECTS", href: "/projects" },
    { name: "WORK WITH US", href: "/work-with-us" },
    { name: "STORE", href: "/store" },
    { name: "ABOUT", href: "/about" },
    { name: "CONTACT", href: "/contact" },
];
---

<header
    class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 border-b border-transparent"
    id="main-header"
>
    <div
        class="absolute inset-0 bg-black/50 backdrop-blur-xl transition-opacity duration-300"
        id="header-bg"
    >
    </div>
    <div class="container mx-auto px-6 h-20 relative z-10">
        <div class="flex items-center justify-between h-full">
            <!-- Logo -->
            <a href="/" class="flex items-center gap-2 group">
                <img
                    src="/nslogo.svg"
                    alt="North Star AGI"
                    class="h-10 w-auto"
                />
                <span
                    class="font-bold text-white tracking-wider group-hover:text-white/80 transition-colors"
                    >NORTH STAR</span
                >
            </a>

            <!-- Desktop Navigation -->
            <nav class="hidden lg:flex items-center gap-8">
                {
                    navLinks.map((link) => (
                        <div class="relative group">
                            <a
                                href={link.href}
                                target={link.external ? "_blank" : "_self"}
                                rel={link.external ? "noopener noreferrer" : ""}
                                class="flex items-center gap-1 text-sm font-medium text-white/80 hover:text-white transition-colors tracking-wide py-2"
                            >
                                {link.name}
                                {link.dropdown && (
                                    <ChevronDown className="w-4 h-4 transition-transform duration-200 group-hover:rotate-180" />
                                )}
                            </a>

                            {/* Dropdown Menu */}
                            {link.dropdown && (
                                <div class="absolute top-full left-1/2 -translate-x-1/2 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform translate-y-2 group-hover:translate-y-0">
                                    <div class="bg-black/90 backdrop-blur-xl border border-white/10 rounded-xl p-2 min-w-[160px] shadow-2xl">
                                        {link.dropdown.map((item) => (
                                            <a
                                                href={item.href}
                                                target={
                                                    item.external
                                                        ? "_blank"
                                                        : "_self"
                                                }
                                                rel={
                                                    item.external
                                                        ? "noopener noreferrer"
                                                        : ""
                                                }
                                                class="flex items-center gap-3 px-4 py-2 text-sm text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-all"
                                            >
                                                {item.icon && (
                                                    <img src={item.icon} alt="" class="w-5 h-5 object-contain" />
                                                )}
                                                {item.name}
                                            </a>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    ))
                }
            </nav>

            <!-- Mobile Menu Toggle -->
            <button
                id="mobile-menu-toggle"
                class="lg:hidden text-white hover:text-white/80 transition-colors"
            >
                <Menu className="w-6 h-6" />
            </button>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div
        id="mobile-menu"
        class="fixed inset-0 bg-black/95 backdrop-blur-xl z-40 pt-24 px-6 lg:hidden opacity-0 invisible transition-all duration-300 transform translate-x-full"
    >
        <button
            id="mobile-menu-close"
            class="absolute top-6 right-6 text-white hover:text-white/80 transition-colors"
        >
            <X className="w-6 h-6" />
        </button>

        <div class="flex flex-col space-y-6">
            {
                navLinks.map((link) => (
                    <div>
                        {link.dropdown ? (
                            <div class="space-y-2">
                                <div class="text-lg font-bold text-white tracking-wide border-b border-white/10 pb-2 mb-2">
                                    {link.name}
                                </div>
                                <div class="pl-4 flex flex-col space-y-3">
                                    {link.dropdown.map((item) => (
                                        <a
                                            href={item.href}
                                            target={
                                                item.external
                                                    ? "_blank"
                                                    : "_self"
                                            }
                                            rel={
                                                item.external
                                                    ? "noopener noreferrer"
                                                    : ""
                                            }
                                            class="flex items-center gap-3 text-base text-white/70 hover:text-white transition-colors"
                                        >
                                            {item.icon && (
                                                <img src={item.icon} alt="" class="w-5 h-5 object-contain" />
                                            )}
                                            {item.name}
                                        </a>
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <a
                                href={link.href}
                                target={link.external ? "_blank" : "_self"}
                                rel={link.external ? "noopener noreferrer" : ""}
                                class="block text-lg font-bold text-white tracking-wide hover:text-white/80 transition-colors"
                            >
                                {link.name}
                            </a>
                        )}
                    </div>
                ))
            }
        </div>
    </div>
</header>

<script>
    const mobileMenuToggle = document.getElementById("mobile-menu-toggle");
    const mobileMenuClose = document.getElementById("mobile-menu-close");
    const mobileMenu = document.getElementById("mobile-menu");

    function toggleMenu(show: boolean) {
        if (!mobileMenu) return;
        if (show) {
            mobileMenu.classList.remove(
                "opacity-0",
                "invisible",
                "translate-x-full",
            );
            mobileMenu.classList.add("opacity-100", "visible", "translate-x-0");
            document.body.style.overflow = "hidden";
        } else {
            mobileMenu.classList.add(
                "opacity-0",
                "invisible",
                "translate-x-full",
            );
            mobileMenu.classList.remove(
                "opacity-100",
                "visible",
                "translate-x-0",
            );
            document.body.style.overflow = "";
        }
    }

    mobileMenuToggle?.addEventListener("click", () => toggleMenu(true));
    mobileMenuClose?.addEventListener("click", () => toggleMenu(false));
</script>
